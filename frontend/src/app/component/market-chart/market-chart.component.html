<div class="trading-container">
  <!-- Chart Section -->
  <div id="tradingview-chart" class="chart-box"></div>

  <!-- Trading Panel -->
  <aside *ngIf="coinSymbol" class="trading-panel">
    <header>
      <h2>{{ coinName }} Demo Trading</h2>
      <p class="balance">ðŸ’° Balance: {{ demoBalance | currency: 'USD' }}</p>
    </header>

    <form (ngSubmit)="performTrade()" class="trade-form">
      <label for="tradeAmount">Amount</label>
      <input
        type="number"
        id="tradeAmount"
        [(ngModel)]="tradeAmount"
        name="tradeAmount"
        required
        min="0.01"
        placeholder="Enter amount"
      />
      <div class="button-group">
        <button type="button" class="buy" (click)="executeTrade('buy')">Buy</button>
        <button type="button" class="sell" (click)="executeTrade('sell')">Sell</button>
      </div>
    </form>

    <section class="portfolio">
      <h3>ðŸ“Š Your Portfolio</h3>
      <p>Holdings: {{ holdings[coinSymbol] || 0 }} {{ coinSymbol }}</p>
      <p
        class="pl"
        [ngClass]="{
          profit: currentProfitOrLoss >= 0,
          loss: currentProfitOrLoss < 0
        }"
      >
        P/L: {{ currentProfitOrLoss | currency: 'USD' }}
      </p>
    </section>

    <section class="trade-history">
      <h3>ðŸ“ˆ Trade History</h3>

      <!-- Filter, Sort, and Export -->
      <div class="trade-history-controls">
  <label>
    Filter:
    <select [(ngModel)]="tradeFilter" name="tradeFilter">
      <option value="">All</option>
      <option value="buy">Buy</option>
      <option value="sell">Sell</option>
    </select>
  </label>

  <label>
    Sort by:
    <select [(ngModel)]="sortField" name="sortField">
      <option value="">None</option>
      <option value="amount">Amount</option>
      <option value="price">Price</option>
      <option value="date">Date</option>
    </select>
  </label>

  <button (click)="exportHistory()">â¬‡ Export CSV</button>
</div>


      <!-- Trade Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Amount</th>
              <th>Price</th>
              <th>Total</th>
              <th>P/L</th>
              <th>Status</th>
              <th>Note</th>
              <th>Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let trade of filteredHistory; let i = index">
              <td [ngClass]="{ profit: trade.type === 'buy', loss: trade.type === 'sell' }">
                {{ trade.type | titlecase }}
              </td>
              <td>{{ trade.amount }}</td>
              <td>{{ trade.price | currency: 'USD' }}</td>
              <td>{{ trade.total | currency: 'USD' }}</td>
              <td [ngClass]="getTradeClass(trade)">
                {{ calculateTradePL(trade) | currency: 'USD' }}
              </td>
              <td>{{ trade.status || 'executed' }}</td>
              <td>{{ trade.note || 'â€”' }}</td>
              <td>{{ trade.date | date: 'short' }}</td>
              <td>
                <button (click)="deleteTrade(i)" style="background: #444; color: red; border: none; padding: 4px 8px; border-radius: 4px;">
                  âœ–
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div style="text-align: center; margin-top: 10px;">
        <button (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">â¬… Prev</button>
        <span style="margin: 0 12px;">Page {{ currentPage }} of {{ totalPages() }}</span>
        <button (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages()">Next âž¡</button>
      </div>
    </section>
  </aside>
</div>
